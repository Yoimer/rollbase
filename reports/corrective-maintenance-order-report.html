<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Corrective Maintenance Order Report {!name#text} </title>
        <style>
            td , th 
            {
            border: 0px solid black;
            }
            .det
            {
            font-weight: bold;
            } 
            body
            {
            font: normal 10px Verdana, Arial, sans-serif;
            }
        </style>
    </head>
    <body>
        <!-- start -->
        <!-------  DATOS SOS --------->
            <table style="border: 0px solid black;" width="100%" bgcolor="#FBE5D6"> 
               <tr> 
               <td width="60%" style="border: 0px solid black;"><img src="http://www.dev01.nextwells.com/storage/servlet/Image?c=1988012&fileName=tmp_4811332897568722777.png&contentType=image%2Fpng&suggestedName=SOS+logo.png" width=20% ></td>
               <td  style="border: 0px solid black;"><div align=center> <b>Special Oilfield Services Co.LLC<br>Corrective Maintenance Order Report<br>
               <font color=red>{!name}</font></b> 
               </div></td>
               </tr>
            </table>
        <br>

        <!-- Title Header -->
        <div style="background:#d5d5d5;" align=center>
            <table  style="border: 0px solid black; margin-top: 20px;"width = "100%">
                <tr>
                    <td align=center>
                        <h5>Corrective Maintenance Order Information</h5>
                        <br> 
                    </td>
                </tr>
            </table>
        </div>
        <br>

        <!-- smaller br -->
        <div style="line-height:25%;">
            <br>
        </div>

        <!(Corrective Order, Object Type, Object Code) -->
        <table style="border: 0px solid black;"width = "100%">
            <tr>
                <td width="40%" style="border: 1px solid black;">
                    <table width="100%">
                        <tr>
                            <td width="60%">&nbsp;Corrective Order: &nbsp;{!Corrective_Maintenance_Order_Read_Only}</td>
                        </tr>
                    </table>
                </td>
                <td  width="30%" style="border: 1px solid black;">
                    <table width="100%">
                        <tr>
                            <td width="63%">&nbsp;Object Type:&nbsp;{!Object_Type}</td>
                        </tr>
                    </table>
                </td>
                <td  width="30%" style="border: 1px solid black;">
                    <table width="100%">
                        <tr>
                            <td width="63%">&nbsp;Object Code: &nbsp;{!Unit_Value}</td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>

        <!-- smaller br -->
        <div style="line-height:25%;">
            <br>
        </div>

        <!(Creation Date, Type Corrective, Priority Order) -->
        <table style="border: 0px solid black;"width = "100%">
            <tr>
                <td width="40%" style="border: 1px solid black;">
                    <table width="100%">
                        <tr>
                            <td width="60%">&nbsp;Creation Date: &nbsp;{!Creation_Date}</td>
                        </tr>
                    </table>
                </td>
                <td  width="30%" style="border: 1px solid black;">
                    <table width="100%">
                        <tr>
                            <td width="63%">&nbsp;Type Corrective:&nbsp;{!Type_Corrective_Maintenance}</td>
                        </tr>
                    </table>
                </td>
                <td  width="30%" style="border: 1px solid black;">
                    <table width="100%">
                        <tr>
                            <td width="63%">&nbsp;Priority Order: &nbsp;{!Priority_Order}</td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>

        <!-- smaller br -->
        <div style="line-height:25%;">
            <br>
        </div>

        <!(Spare Parts?, Expected Date Spare, Require CAR/PAR/NO, Root Analisys?) -->
        <table style="border: 0px solid black;"width = "100%">
            <tr>
                <td width="25%" style="border: 1px solid black;">
                    <table width="100%">
                        <tr>
                            <td width="60%">&nbsp;Spare Parts?: &nbsp;{!Require_Spare_Parts}</td>
                        </tr>
                    </table>
                </td>
                <td  width="25%" style="border: 1px solid black;">
                    <table width="100%">
                        <tr>
                            <td width="63%">&nbsp;Expected Date Spare:&nbsp;{!Expected_Date_Spare_Parts}</td>
                        </tr>
                    </table>
                </td>
                <td  width="25%" style="border: 1px solid black;">
                    <table width="100%">
                        <tr>
                            <td width="63%">&nbsp;Require CAR/PAR/NO: &nbsp;{!Require_CAR_PAR}</td>
                        </tr>
                    </table>
                </td>
                <td  width="25%" style="border: 1px solid black;">
                    <table width="100%">
                        <tr>
                            <td width="63%">&nbsp;Root Analisys?: &nbsp;{!Require_Root_Cause_Analisys}</td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>

        <!-- smaller br -->
        <div style="line-height:25%;">
            <br>
        </div>

        <!(Third Parties Activities? Scheduled Begin Date, Scheduled End Date) -->
        <table style="border: 0px solid black;"width = "100%">
            <tr>
                <td  width="34%" style="border: 1px solid black;">
                    <table width="100%">
                        <tr>
                            <td width="63%">&nbsp;Third Parties Activities?: &nbsp;{!Require_Third_Parties_Activities}</td>
                        </tr>
                    </table>
                </td>
                <td  width="33%" style="border: 1px solid black;">
                    <table width="100%">
                        <tr>
                            <td width="63%">&nbsp;Scheduled Begin Date:&nbsp;{!Scheduled_Begin_Date}</td>
                        </tr>
                    </table>
                </td>
                <td  width="33%" style="border: 1px solid black;">
                    <table width="100%">
                        <tr>
                            <td width="63%">&nbsp;Scheduled End Date: &nbsp;{!Scheduled_End_Date}</td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>

        <!-- smaller br -->
        <div style="line-height:25%;">
            <br>
        </div>

        <!(Failure Description) -->
        <table style="border: 0px solid black;"width = "100%">
            <tr>
                <td  width="100%" style="border: 1px solid black;">
                    <table width="100%">
                        <tr>
                            <td width="63%">&nbsp;Failure Description:&nbsp;{!Failure_Short_Description}</td>
                        </tr>
                    </table>
                </td>
        </table>

        <!-- smaller br -->
        <div style="line-height:25%;">
            <br>
        </div>

Detailed Procedure
        <textarea style="overflow:hidden" rows="02" cols="73">
{!Detailed_Procedure}
        </textarea>

        <!-- smaller br -->
        <div style="line-height:25%;">
            <br>
        </div>

Aceptance Criterias
        <textarea style="overflow:hidden" rows="02" cols="73">
{!Aceptance_Criterias}
        </textarea>

        <!-- smaller br -->
        <div style="line-height:25%;">
            <br>
        </div>

Description Root Cause Analisys
        <textarea style="overflow:hidden" rows="02" cols="73">
{!Description_Root_Cause_Analisys}
        </textarea>

        <!-- smaller br -->
        <div style="line-height:25%;">
            <br>
        </div>

Third Parties Activities
        <textarea style="overflow:hidden" rows="02" cols="73">
{!Third_Parties_Activities}
        </textarea>

        <!-- smaller br -->
        <div style="line-height:25%;">
            <br>
        </div>

        <!(Reviewed By, Approved By) -->
        <table style="border: 0px solid black;"width = "100%">
            <tr>
                <td  width="50%" style="border: 1px solid black;">
                    <table width="100%">
                        <tr>
                            <td width="63%">&nbsp;Reviewed By: &nbsp;{!Reviewed_By_no_Hyperlink}</td>
                        </tr>
                    </table>
                </td>
                <td  width="50%" style="border: 1px solid black;">
                    <table width="100%">
                        <tr>
                            <td width="63%">&nbsp;Approved By:&nbsp;{!Approved_By_no_Hyperlink}</td>
                        </tr>
                    </table>
                </td>
        </table>
        <br>

        <!-- Title Header -->
        <div style="background:#d5d5d5;" align=center>
            <table  style="border: 0px solid black; margin-top: 20px;"width = "100%">
                <tr>
                    <td align=center>
                        <h5>Close Corrective Maintenance Order Information</h5>
                        <h6 style="color:red">Closing Date: {!Closing_Date}</h6>
                    </td>
                </tr>
            </table>
        </div>
        <br>

Remarks
        <textarea style="overflow:hidden" rows="02" cols="73">
{!Remarks}
        </textarea>

        <!-- smaller br -->
        <div style="line-height:25%;">
            <br>
        </div>

Major Actitivities
        <textarea style="overflow:hidden" rows="02" cols="73">
{!Major_Activities}
        </textarea>

        <!-- smaller br -->
        <div style="line-height:25%;">
            <br>
        </div>

        <!(Close Reviewed By, Close Approved By) -->
        <table style="border: 0px solid black;"width = "100%">
            <tr>
                <td  width="50%" style="border: 1px solid black;">
                    <table width="100%">
                        <tr>
                            <td width="63%">&nbsp;Close Reviewed By: &nbsp;{!Close_Reviewed_By_no_Hyperlinked}</td>
                        </tr>
                    </table>
                </td>
                <td  width="50%" style="border: 1px solid black;">
                    <table width="100%">
                        <tr>
                            <td width="63%">&nbsp;Close Approved By:&nbsp;{!Close_Approved_By_no_hyperlinked}</td>
                        </tr>
                    </table>
                </td>
        </table>

        #EVAL[

            <!-- check existing capa function -->
            function check_existing_capa() {

                <!-- gets CAPA info -->
                var check_capa = '{!Require_CAR_PAR}';

                <!-- get CAPA info -->
                var capa_info_from_db = rbv_api.selectQuery( "SELECT CAPA_number, createdAt, Reason_for_CAPA, Target_Date, Description_of_the_Problem, Actions_Implemented FROM CAPA where R4908782=?", 100, {!id});

                if((check_capa !== 'NO') && (capa_info_from_db.length > 0)) {
                    <!-- change data format  in Created At, Target Date and also replaces any null remaining by empty -->
                    for (var i=0; i < capa_info_from_db.length; i++) {

                        if (capa_info_from_db[0][1] !== ' '){
                            capa_info_from_db[0][1] = rbv_api.formatDate(capa_info_from_db[0][1], "MM/dd/YYYY");
                        }

                        if (capa_info_from_db[0][3] !== ' '){
                            capa_info_from_db[0][3] = rbv_api.formatDate(capa_info_from_db[0][3], "MM/dd/YYYY");
                        }

                        for (var j=0; j < 6; j++) {
                            if(capa_info_from_db[i][j] === null) {
                                capa_info_from_db[i][j] = ' ';
                            }
                        }
                    }

                    <!-- CAPA information -->
                    build_report += '<br>'+
                    '<div style="background:#d5d5d5;" align=center>'+
                    '    <table  style="border: 0px solid black; margin-top: 20px;"width = "100%">'+
                    '        <tr>'+
                    '            <td align=center>'+
                    '                <h5>CAPA Information</h5>'+
                    '                <br> '+
                    '            </td>'+
                    '        </tr>'+
                    '    </table>'+
                    '</div>'+
                    '<br>'+
                    ''+
                    '<table style="border: 0px solid black;"width = "100%">'+
                    '    <tr>'+
                    '        <td width="25%" style="border: 1px solid black;">'+
                    '            <table width="100%">'+
                    '                <tr>'+
                    '                    <td width="60%">CAPA No: ' +capa_info_from_db[0][0]+ '</td>'+
                    '                </tr>'+
                    '            </table>'+
                    '        </td>'+
                    '        <td  width="25%" style="border: 1px solid black;">'+
                    '            <table width="100%">'+
                    '                <tr>'+
                    '                    <td width="63%">Created At: ' +capa_info_from_db[0][1]+ ' </td>'+
                    '                </tr>'+
                    '            </table>'+
                    '        </td>'+
                    '        <td  width="25%" style="border: 1px solid black;">'+
                    '            <table width="100%">'+
                    '                <tr>'+
                    '                    <td width="63%">Reason for the CAPA: ' +capa_info_from_db[0][2]+ ' </td>'+
                    '                </tr>'+
                    '            </table>'+
                    '        </td>'+
                    '        <td  width="25%" style="border: 1px solid black;">'+
                    '            <table width="100%">'+
                    '                <tr>'+
                    '                    <td width="63%">Target Date: ' +capa_info_from_db[0][3]+ ' </td>'+
                    '                </tr>'+
                    '            </table>'+
                    '        </td>'+
                    '    </tr>'+
                    '</table>';

                    <!-- two textareas -->
                    <!-- Description of the Problem and Actions Implemented-->
                    build_report += '   Description of the Problem  '  + 
                    '   <textarea style="overflow:hidden" rows="02" cols="73">' +capa_info_from_db[0][4]+ '  '  + 
                    '   </textarea>  '  + 
                    '     '  + 
                    '     '  + 
                    '   <!-- smaller br -->  '  + 
                    '   <div style="line-height:25%;">  '  + 
                    '       <br>  '  + 
                    '   </div>  '  + 
                    '     '  + 
                    '   Actions Implemented  '  + 
                    '   <textarea style="overflow:hidden" rows="02" cols="73">' +capa_info_from_db[0][5]+ '  '  + 
                    '  </textarea>  ' ; 

                    return build_report;

                <!-- there is no CAPA -->
                } else {

                    return ' ';
                }
            }
            check_existing_capa();
        ]

    </body>
</html>