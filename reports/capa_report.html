<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>DOR Report {!name#text} </title>
        <style>
            td , th 
            {
            border: 0px solid black;
            }
            .det
            {
            font-weight: bold;
            } 
            body
            {
            font: normal 10px Verdana, Arial, sans-serif;
            }
        </style>
    </head>
    <body>
        <!-- start -->
        <!-------  DATOS RAY --------->
<!--         <table style="border: 0px solid black;" width="100%" bgcolor="#7BD2F6">
            <tr>
                <td width="60%" style="border: 0px solid black;"><img src="http://www.dev01.nextwells.com/storage/servlet/Image?c=1988012&fileName=tmp_2259442075296695783.jpg&contentType=image%2Fjpeg&suggestedName=sos_logo_original.jpg" width=20% ></td>
                <td  style="border: 0px solid black;">
                    <div align=center> <b>Ray International Oil & gas<br>CAPA Report<br>
                        <font color=red>{!name}</font></b> 
                    </div>
                </td>
            </tr>
        </table> -->
        <!-------  DATOS SOS ---------
            <table style="border: 0px solid black;" width="100%"> 
               <tr> 
               <td width="60%" style="border: 0px solid black;"><img src="http://www.dev01.nextwells.com/storage/servlet/Image?c=1794941&fileName=tmp_6615320518035872419.jpg&contentType=image%2Fjpeg&suggestedName=SOS+logo.jpg" width=20% ></td>
               <td  style="border: 0px solid black;"><div align=center> <b>Special Oilfield Services Co.LLC<br>Daily Operational Report Directional <br>
               <font color=red>{!DOR_expression}</font></b> 
               </div></td>
               </tr>
            </table>-->
            <table style="border: 0px solid black;" width="100%" bgcolor="#FBE5D6"> 
               <tr> 
               <td width="60%" style="border: 0px solid black;"><img src="http://www.dev01.nextwells.com/storage/servlet/Image?c=1988012&fileName=tmp_4811332897568722777.png&contentType=image%2Fpng&suggestedName=SOS+logo.png" width=20% ></td>
               <td  style="border: 0px solid black;"><div align=center> <b>Special Oilfield Services Co.LLC<br>CAPA Report<br>
               <font color=red>{!name}</font></b> 
               </div></td>
               </tr>
            </table>
        <br>

        <!-- Title Header -->
        <div style="background:#d5d5d5;" align=center>
            <table  style="border: 0px solid black; margin-top: 20px;"width = "100%">
                <tr>
                    <td align=center>
                        <h5>CAPA Information</h5>
                        <br> 
                    </td>
                </tr>
            </table>
        </div>
        <br>

        <!(initiator, created at, target date) -->
        <table style="border: 0px solid black;"width = "100%">
        <tr>
            <td width="26%" style="border: 1px solid black;">
                <table width="100%">
                    <tr>
                        <td width="60%">&nbsp;Initiator: &nbsp;{!Initiator_READ_ONLY}</td>
                    </tr>
                </table>
            </td>
            <td  width="37%" style="border: 1px solid black;">
                <table width="100%">
                    <tr>
                        <td width="63%">&nbsp;Created At: &nbsp;{!createdAt}</td>
                    </tr>
                </table>
            </td>
            <td  width="37%" style="border: 1px solid black;">
                <table width="100%">
                    <tr>
                        <td width="63%">&nbsp;Target Date: &nbsp;{!Target_Date}</td>
                    </tr>
                </table>
            </td>
        </tr>
        </table>

        <!-- smaller br -->
        <div style="line-height:25%;">
            <br>
        </div>

        <!(department, reason for the capa, capa from) -->
        <table style="border: 0px solid black;"width = "100%">
        <tr>
            <td width="40%" style="border: 1px solid black;">
                <table width="100%">
                    <tr>
                        <td width="60%">&nbsp;Department: &nbsp;{!Department_No_Hyperlinked}</td>
                    </tr>
                </table>
            </td>
            <td  width="30%" style="border: 1px solid black;">
                <table width="100%">
                    <tr>
                        <td width="63%">&nbsp;Reason for the capa: &nbsp;{!_Reason_for_the_CAPA}</td>
                    </tr>
                </table>
            </td>
            <td  width="30%" style="border: 1px solid black;">
                <table width="100%">
                    <tr>
                        <td width="63%">&nbsp;Capa From: &nbsp;{!CAPA_from}</td>
                    </tr>
                </table>
            </td>
        </tr>
        </table>

        <!-- smaller br -->
        <div style="line-height:25%;">
            <br>
        </div>

        <!(action type, asset, service line) -->
        <table style="border: 0px solid black;"width = "100%">
        <tr>
            <td width="40%" style="border: 1px solid black;">
                <table width="100%">
                    <tr>
                        <td width="60%">&nbsp;Action Type: &nbsp;{!Action_Type_}</td>
                    </tr>
                </table>
            </td>
            <td  width="30%" style="border: 1px solid black;">
                <table width="100%">
                    <tr>
                        <td width="63%">&nbsp;Asset: &nbsp;{!Asset_Formula}</td>
                    </tr>
                </table>
            </td>
            <td  width="30%" style="border: 1px solid black;">
                <table width="100%">
                    <tr>
                        <td width="63%">&nbsp;Service Line: &nbsp;{!Service_Lines_Formula}</td>
                    </tr>
                </table>
            </td>
        </tr>
        </table>

        <!-- smaller br -->
        <div style="line-height:25%;">
            <br>
        </div>

        <!(standard reference, procedure reference, clause number) -->
        <table style="border: 0px solid black;"width = "100%">
        <tr>
            <td width="40%" style="border: 1px solid black;">
                <table width="100%">
                    <tr>
                        <td width="60%">&nbsp;Standard Reference: &nbsp;{!Standard_Reference}</td>
                    </tr>
                </table>
            </td>
            <td  width="30%" style="border: 1px solid black;">
                <table width="100%">
                    <tr>
                        <td width="63%">&nbsp;Procedure Reference: &nbsp;{!Procedure_Reference}</td>
                    </tr>
                </table>
            </td>
            <td  width="30%" style="border: 1px solid black;">
                <table width="100%">
                    <tr>
                        <td width="63%">&nbsp;Clause Number: &nbsp;{!Clause_Number}</td>
                    </tr>
                </table>
            </td>
        </tr>
        </table>

        <!-- smaller br -->
        <div style="line-height:25%;">
            <br>
        </div>

        <!(job number, npt) -->
        <table style="border: 0px solid black;"width = "100%">
        <tr>
            <td width="26%" style="border: 1px solid black;">
                <table width="100%">
                    <tr>
                        <td width="60%">&nbsp;Job Number: &nbsp;{!Job_Number_Formula}</td>
                    </tr>
                </table>
            </td>
            <td  width="74%" style="border: 1px solid black;">
                <table width="100%">
                    <tr>
                        <td width="63%">&nbsp;NPT: &nbsp;{!NPT}</td>
                    </tr>
                </table>
            </td>
        </tr>
        </table>

        <!-- smaller br -->
        <div style="line-height:25%;">
            <br>
        </div>

Description of the problem
        <textarea style="overflow:hidden" rows="02" cols="73">
<!--    Lookup (Reason for the CAPA Type)R4692505 -->
{!Description_of_the_Problem}
        </textarea>

        <!-- smaller br -->
        <div style="line-height:25%;">
            <br>
        </div>

Objective Evidence
        <textarea style="overflow:hidden" rows="02" cols="73">
{!Objective_Evidence}
        </textarea>

        <!-- break line after a textearea -->
        <div style="line-height:100%;">
            <br>
        </div>

        <!-- Tool Selection Header -->
        <div style="background:#d5d5d5;" align=center>
            <table  style="border: 0px solid black; margin-top: 20px;"width = "100%">
                <tr>
                    <td align=center>
                        <h5>Tool Selection</h5>
                        <br> 
                    </td>
                </tr>
            </table>
        </div>
        <br>

        <table style="border: 0px solid black;"width = "100%">
            <tr>
                <th>Type</th>
                <th>Code</th>
                <th>Serial Number</th>
                <tr>
                    <td width="34%" style="border: 1px solid black; "><strong>Product&Material</strong></td>
                    <td width="33%" style="border: 1px solid black;">.{!Product_Code}</td>
                    <td width="33" style="border: 1px solid black;">.{!Product_Serial_Number}</td>
                </tr>

                <tr>
                    <td width="34%" style="border: 1px solid black;"><strong>Equipment</strong></td>
                    <td width="33%" style="border: 1px solid black;">.{!Equipment_Code}</td>
                    <td width="33%" style="border: 1px solid black;">.{!Equipment_Serial_Number}</td>
                </tr>

                <tr>
                    <td width="34%" style="border: 1px solid black;"><strong>Tools</strong></td>
                    <td width="33%" style="border: 1px solid black;">.{!Tool_Code}</td>
                    <td width="33%" style="border: 1px solid black;">.{!Tool_Serial_Number}</td>
                </tr>
                <tr>
                    <td width="34%" style="border: 1px solid black;"><strong>MDE</strong></td>
                    <td width="33%" style="border: 1px solid black;">.{!MDE_Code_Formula}</td>
                    <td width="33%" style="border: 1px solid black;">.{!MDE_Serial_Number_Formula}</td>
                </tr>
            </tr>
        </table>

        <br>

        <!-- Validation Header -->
        <div style="background:#d5d5d5;" align=center>
            <table  style="border: 0px solid black; margin-top: 20px;"width = "100%">
                <tr>
                    <td align=center>
                        <h5>Validation</h5>
                        <br> 
                    </td>
                </tr>
            </table>
        </div>
        <br>

        <!(case worker) -->
        <table style="border: 0px solid black;"width = "100%">
            <tr>
                <td width="26%" style="border: 1px solid black;">
                    <table width="100%">
                        <tr>
                            <td width="60%">&nbsp;Case Worker: &nbsp;{!Case_Worker_Formula}</td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>

Validation Comments
        <textarea style="overflow:hidden" rows="02" cols="73">
{!Validation_comments}
        </textarea>
        <pd4ml:page.break>

        <!-- Investigation Header -->
        <div style="background:#d5d5d5;" align=center>
            <table  style="border: 0px solid black; margin-top: 20px;"width = "100%">
                <tr>
                    <td align=center>
                        <h5>Investigation</h5>
                        <br> 
                    </td>
                </tr>
            </table>
        </div>
        <br>

        <!(cause level 1, cause leve 2, implementation date) -->
        <table style="border: 0px solid black;"width = "100%">
        <tr>
            <td width="40%" style="border: 1px solid black;">
                <table width="100%">
                    <tr>
                        <td width="60%">&nbsp;Cause Level 1: &nbsp;{!Cause_Level_1_Formula}</td>
                    </tr>
                </table>
            </td>
            <td  width="30%" style="border: 1px solid black;">
                <table width="100%">
                    <tr>
                        <td width="63%">&nbsp;Cause Level 2: &nbsp;{!Cause_Level_2_Formula}</td>
                    </tr>
                </table>
            </td>
            <td  width="30%" style="border: 1px solid black;">
                <table width="100%">
                    <tr>
                        <td width="63%">&nbsp;Implementation Date: &nbsp;{!Implementation_Date}</td>
                    </tr>
                </table>
            </td>
        </tr>
        </table>

        <!-- smaller br -->
        <div style="line-height:25%;">
            <br>
        </div>

Immediate Correction
        <textarea style="overflow:hidden" rows="02" cols="73">
{!Immediate_Correction}
        </textarea>

        <!-- smaller br -->
        <div style="line-height:25%;">
            <br>
        </div>

Corrective Action Plan
        <textarea style="overflow:hidden" rows="02" cols="73">
{!Corrective_Action_Plan}
        </textarea>

        <!-- break line after a textearea -->
        <div style="line-height:100%;">
            <br>
        </div>

        <!-- Approval Header -->
        <div style="background:#d5d5d5;" align=center>
            <table  style="border: 0px solid black; margin-top: 20px;"width = "100%">
                <tr>
                    <td align=center>
                        <h5>Approval</h5>
                        <br> 
                    </td>
                </tr>
            </table>
        </div>

        <!-- smaller br -->
        <div style="line-height:25%;">
            <br>
        </div>

Plan Approval Observations
        <textarea style="overflow:hidden" rows="02" cols="73">
{!Plan_Approval_Observations}
        </textarea>

        <!-- break line after a textearea -->
        <div style="line-height:100%;">
            <br>
        </div>

        <!-- Implementation Header -->
        <div style="background:#d5d5d5;" align=center>
            <table  style="border: 0px solid black; margin-top: 20px;"width = "100%">
                <tr>
                    <td align=center>
                        <h5>Implementation</h5>
                        <br> 
                    </td>
                </tr>
            </table>
        </div>

        <!-- smaller br -->
        <div style="line-height:25%;">
            <br>
        </div>

Actions Implemented
        <textarea style="overflow:hidden" rows="02" cols="73">
{!Actions_Implemented}
        </textarea>

        <!-- smaller br -->
        <div style="line-height:25%;">
            <br>
        </div>

        <!(evidences) -->
        <table style="border: 0px solid black;"width = "100%">
            <tr>
                <td width="26%" style="border: 1px solid black;">
                    <table width="100%">
                        <tr>
                            <td width="60%">&nbsp;Evidences: &nbsp;{!Evidences}</td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
        <br>

        <!-- Effectiveness Header -->
        <div style="background:#d5d5d5;" align=center>
            <table  style="border: 0px solid black; margin-top: 20px;"width = "100%">
                <tr>
                    <td align=center>
                        <h5>Effectiveness</h5>
                        <br> 
                    </td>
                </tr>
            </table>
        </div>
        <br>

        <!(will this action prevent recurrence, close date) -->
        <table style="border: 0px solid black;"width = "100%">
        <tr>
            <td width="50%" style="border: 1px solid black;">
                <table width="100%">
                    <tr>
                        <td width="60%">&nbsp;Will this Action prevent Recurrence: &nbsp;{!Will_this_Action_Prevent_Recurrence}</td>
                    </tr>
                </table>
            </td>
            <td  width="50%" style="border: 1px solid black;">
                <table width="100%">
                    <tr>
                        <td width="63%">&nbsp;Close Date: &nbsp;{!Close_Date}</td>
                    </tr>
                </table>
            </td>
        </tr>
        </table>

        <!-- smaller br -->
        <div style="line-height:25%;">
            <br>
        </div>

Effectiveness of Actions Taken
        <textarea style="overflow:hidden" rows="02" cols="73">
{!Effectiveness_of_Actions_Taken}
        </textarea>

        <!-- break line after a textearea -->
        <div style="line-height:100%;">
            <br>
        </div>

        #EVAL[

            <!-- check existing rejection function -->
            function check_existing_rejection() {

                <!-- R226176 is Rejection relationship with CAPA -->

                <!-- We only want to get title, observations and attachments field values -->

                <!-- user has to create a expression field returning the values they want to get on this query. -->

                <!-- on Rejection object the field Attachment_Read_Only is a expression field -->

                <!-- returning return '{!Attachment#origFileName}';.-->

                <!-- this is because the Attachment object returns while quering a string like: -->

                <!-- "#Mon Apr 08 14:31:58 UTC 2019\nfileSize=116225\norigFileName=Las aves de Pan.doc\ncontentType=application/msword\nfileName=74/tmp_1200242532873688438.doc\n";. -->

                <!-- we only want to get the name of the attached file. -->

                var rejection = rbv_api.selectQuery("SELECT Title_READ_ONLY, Observations, Attachment_Read_Only FROM Rejection WHERE name= '{!R226176#value}'", 999);

                <!-- if there is any rejection, show fields values on report, else don't do it -->
                if(rejection.length > 0) {

                    <!-- Rejection Header -->
                    var build_report = '<!-- Rejection Header -->'+
                    '        <div style="background:#d5d5d5;" align=center>'+
                    '            <table  style="border: 0px solid black; margin-top: 20px;"width = "100%">'+
                    '                <tr>'+
                    '                    <td align=center>'+
                    '                        <h5>Rejection</h5>'+
                    '                        <br> '+
                    '                    </td>'+
                    '                </tr>'+
                    '            </table>'+
                    '        </div>'+
                    '        <br>'+
                    ''+
                    '        <!(title, attachment, observation) -->'+
                    '        <table style="border: 0px solid black;"width = "100%">'+
                    '        <tr>'+
                    '            <td width="50%" style="border: 1px solid black;">'+
                    '                <table width="100%">'+
                    '                    <tr>'+
                    '                        <td width="60%">Title:&nbsp;' +rejection[0][0]+ '</td>'+
                    '                    </tr>'+
                    '                </table>'+
                    '            </td>'+
                    '            <td  width="50%" style="border: 1px solid black;">'+
                    '                <table width="100%">'+
                    '                    <tr>'+
                    '                        <td width="63%">Attachment:&nbsp;' +rejection[0][2]+ '</td>'+
                    '                    </tr>'+
                    '                </table>'+
                    '            </td>'+
                    '        </tr>'+
                    '        </table>'+
                    '        <!-- smaller br -->'+
                    '        <div style="line-height:25%;">'+
                    '            <br>'+
                    '        </div>'+
                    '        <table style="border: 0px solid black;"width = "100%">'+
                    '            <tr>'+
                    '                <td width="26%" style="border: 1px solid black;">'+
                    '                    <table width="100%">'+
                    '                        <tr>'+
                    '                            <td width="60%">Observations: &nbsp;' +rejection[0][1]+ '</td>'+
                    '                        </tr>'+
                    '                    </table>'+
                    '                </td>'+
                    '            </tr>'+
                    '        </table>';

                    build_report += '';
                    return build_report;
                } else {
                    return '';
                }
            }
            check_existing_rejection();
        ]

    </body>
</html>